@inject IJSRuntime JS
@inject IncidentReportingSystem.UI.Core.Auth.AuthState AuthState

@code {
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender) return; // חשוב: לרוץ פעם אחת בלבד אחרי שה-circuit אינטראקטיבי

        string? token = null;
        try
        {
            // ודא שirsAuth מוגדר בסקריפט לפני blazor.server.js
            token = await JS.InvokeAsync<string?>("irsAuth.get");
        }
        catch
        {
            // אם הסקריפט לא נטען מסיבה כלשהי – לא להפיל את ה-UI
        }

        // מסמנים שההידרציה הושלמה גם אם אין טוקן
        await AuthState.SetAsync(token);
    }
}
